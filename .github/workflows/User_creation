name: Invoke AWS Lambda and Notify User

on:
  workflow_dispatch:
    inputs:
      user_name:
        description: 'Enter your name'
        required: true
        type: string
      user_email:
        description: 'Enter your email address'
        required: true
        type: string
      tag:
        description: 'Enter the tag'
        required: true
        type: string

jobs:
  invoke_lambda:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1  # Specify your AWS region

      - name: Invoke Lambda Function
        run: |
          aws lambda invoke \
            --function-name your_lambda_function_name \
            --payload '{
              "name": "${{ github.event.inputs.user_name }}",
              "email": "${{ github.event.inputs.user_email }}",
              "tag": "${{ github.event.inputs.tag }}"
            }' \
            response.json
          cat response.json

      - name: Wait for 5 minutes
        uses: jakejarvis/wait-action@master
        with:
          time: '5m'

      - name: Send Email Notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_APP_PASSWORD }}
          subject: 'Workflow Completed Successfully'
          body: 'Hello ${{ github.event.inputs.user_name }},\n\nYour workflow has completed successfully.\n\nBest regards,\nYour Team'
          to: ${{ github.event.inputs.user_email }}
          from: ${{ secrets.EMAIL_USERNAME }}
